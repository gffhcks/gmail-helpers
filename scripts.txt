function filterTester() {
 ArchiveThreads('PagerDuty', '168h')
}


function filterCaller() {

  ArchiveThreads('Alerts', '2d')
  ReadThreads('Alerts', '7d')
  DeleteThreads('Alerts', '14d')

  ArchiveThreads('Newsletters','7d')
  DeleteThreads('Newsletters','30d')

  ArchiveThreads('Commits', '1h')
  ReadThreads('Commits', '24h')
  DeleteThreads('Commits', '30d')

  ArchiveThreads('PagerDuty', '7d')
  ReadThreads('PagerDuty', '7d')
  DeleteThreads('PagerDuty', '30d')

  Logger.log("All tasks complete.")
}

batchSize = 100

// Mark labeled threads as read if they're older than a certain age, but only if they aren't starred.
function ReadThreads(Label, Age) {
  var query = 'label:'+Label+' older_than:'+Age+' is:unread -is:starred'
  Logger.log("Marking as read threads labeled '"+Label+"' older than "+Age+".")
  var threads = GmailApp.search(query);
  for (j = 0; j < threads.length; j+=batchSize) {
    GmailApp.markThreadsRead(threads.slice(j, j+batchSize));
  }
  Logger.log(threads.length+" threads marked.")
}

// Archive labeled threads older than a certain age, but only if they aren't starred.
function ArchiveThreads(Label, Age) {
  var query = 'label:'+Label+' older_than:'+Age+' in:inbox -is:starred'
  Logger.log("Archiving threads labeled '"+Label+"' older than "+Age+".")
  var threads = GmailApp.search(query);
  for (j = 0; j < threads.length; j+=batchSize) {
    GmailApp.moveThreadsToArchive(threads.slice(j, j+batchSize));
  }
  Logger.log(threads.length+" threads archived.")
}

// Delete labeled threads older than a certain age, but only if they aren't in the inbox and aren't starred.
function DeleteThreads(Label, Age) {
  var query = 'label:'+Label+' older_than:'+Age+' -in:inbox -is:starred'
  Logger.log("Moving to trash threads labeled '"+Label+"' older than "+Age+".")
  var threads = GmailApp.search(query);
  for (j = 0; j < threads.length; j+=batchSize) {
    GmailApp.moveThreadsToTrash(threads.slice(j, j+batchSize));
  }
  Logger.log(threads.length+" threads trashed.")
}

function forwardMessage(BeforeLabel, AfterLabel, Address) {
  var query = 'label:'+BeforeLabel+' -label:'+AfterLabel
  # Search Gmail for the label
  # Get all the threads
  # Get every message from each thread
  # Forward them
  # Add the AfterLabel
  # Remove the BeforeLabel
}


function oldFilter(Label, Age)
{
  var lifetime = 1000*60*60*Age;
  var label = GmailApp.getUserLabelByName(Label);
  var threads = label.getThreads();
  var now = new Date().getTime();
  var deadline = now-lifetime;

  for (var i = 0; i < threads.length; i++)
  {
    if(threads[i].isInInbox())
    {
      Logger.log("In Inbox: " + threads[i].getFirstMessageSubject());
      if(threads[i].getLastMessageDate() < deadline & !threads[i].isImportant())
      {
        Logger.log("Old: " + threads[i].getFirstMessageSubject());
        threads[i].moveToArchive();
      }
    }
  }
}
